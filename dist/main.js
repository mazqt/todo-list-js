(()=>{"use strict";const e=class{constructor(e,t,n,i,r){this.title=e,this.project=t,this.dueDate=n,this.priority=i,this.description=r}addNote(e){null==this.notes?this.notes=[e]:this.notes.push(e)}},t=function(){let t={},n=[];const i=function(){const e={data:JSON.stringify(t)};firebase.firestore().collection("JSON").doc("tasks").set(e)},r=function(e){e.sort((function(e,t){return new Date(e.dueDate)-new Date(t.dueDate)||e.priority-t.priority}))};return{retrieveTasks:function(){return r(n),n},saveTask:function(e){void 0===t[e.project]?(t[e.project]=[],t[e.project].push(e)):t[e.project].push(e),n.push(e),i()},taskIndex:function(e){return t[e.project].indexOf(e)},deleteTask:function(e,n){t[n].splice(e,1),0==t[n].length&&delete t[n],i()},saveTasks:i,editTask:function(e,n,i){t[e.project][i].title=n.get("title"),t[e.project][i].project=n.get("project"),t[e.project][i].dueDate=n.get("date"),t[e.project][i].priority=n.get("priority"),t[e.project][i].description=n.get("description")},retrieveProjectList:function(){return Object.keys(t)},retrieveProjectTasks:function(e){const n=t[e];return r(n),n},loadDB:async function(){n=[];let i=await firebase.firestore().collection("JSON").get().then((e=>{let t=e.docs.map((e=>e.data()));return JSON.parse(t[0].data)}));t=i,Object.values(t).forEach((i=>{t[i[0].project]=i.map((t=>(Object.assign(new Date,t.dueDate),t=Object.assign(new e,t),n.push(t),t)))})),console.log(n)}}}(),n=function(){const n=document.getElementById("listOfTasks"),i=document.getElementById("newtask"),r=document.getElementById("dropdown"),o=function(e){n.innerHTML="",console.log(n.innerHTML);const i=document.createElement("div");i.classList.toggle("taskList"),e.forEach((e=>{const n=document.createElement("div"),r=t.taskIndex(e);n.setAttribute("index",r),n.classList.toggle(e.priority);const c=document.createElement("h2");c.innerText=e.title;const a=document.createElement("p");a.innerText=e.dueDate.slice(0,10);const d=document.createElement("p");if(d.innerText=e.description,n.appendChild(c),n.appendChild(a),n.appendChild(d),null!=e.notes){const t=document.createElement("ul");e.notes.forEach((e=>{const n=document.createElement("li");n.innerText=e,t.appendChild(n)})),n.appendChild(t)}const l=document.createElement("button");l.innerText="Delete task",l.addEventListener("click",(function(){confirm("Are you sure you wanna delete this task?")&&(console.log(r),t.deleteTask(r,e.project),t.loadDB().then((()=>{o(t.retrieveTasks())})))})),n.appendChild(l);const u=s(e,r),p=document.createElement("button");p.innerText="Edit task",p.addEventListener("click",(function(){u.classList.toggle("hidden")})),n.appendChild(p),n.appendChild(u),i.appendChild(n)})),n.appendChild(i)},s=function(e,n){const i=document.createElement("form");i.classList.toggle("hidden"),i.classList.toggle("form");const r=document.createElement("label");r.innerText="Title: ",i.appendChild(r);const s=document.createElement("input");s.setAttribute("value",e.title),s.setAttribute("type","text"),s.setAttribute("name","title"),s.setAttribute("required",""),i.appendChild(s);const c=document.createElement("label");c.innerText="Project: ",i.appendChild(c);const a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("name","project"),a.setAttribute("value",e.project),a.setAttribute("required",""),a.setAttribute("list","projects");const d=document.createElement("datalist");d.setAttribute("id","projects"),t.retrieveProjectList().forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),d.appendChild(t)}));const l=document.createElement("option");l.setAttribute("value","Default"),d.appendChild(l),a.appendChild(d),i.appendChild(a);const u=document.createElement("label");u.innerText="Done by: ",i.appendChild(u);const p=document.createElement("input");p.setAttribute("value",e.dueDate),p.setAttribute("type","date"),p.setAttribute("name","date"),p.setAttribute("required",""),p.setAttribute("min",(new Date).toJSON().slice(0,10)),p.setAttribute("max",new Date((new Date).setFullYear((new Date).getFullYear()+1)).toJSON().slice(0,10)),i.appendChild(p);const m=document.createElement("label");m.innerText="Priority: ",i.appendChild(m);const b=document.createElement("select");b.setAttribute("name","priority"),b.setAttribute("required","");const h=document.createElement("option");h.setAttribute("value","1"),h.innerText="High",b.appendChild(h);const E=document.createElement("option");E.setAttribute("value","2"),E.innerText="Medium",b.appendChild(E);const A=document.createElement("option");A.setAttribute("value","3"),A.innerText="Low",b.appendChild(A),i.appendChild(b),"1"==e.priority?h.setAttribute("selected",""):"2"==e.priority?E.setAttribute("selected",""):A.setAttribute("selected","");const T=document.createElement("label");T.innerText="Description: ",i.appendChild(T);const C=document.createElement("textarea");C.classList.toggle("desc"),C.innerText=e.description,C.setAttribute("name","description"),C.setAttribute("type","text"),C.setAttribute("required",""),i.appendChild(C);const f=document.createElement("button");return f.innerText="Edit task",f.setAttribute("type","submit"),i.appendChild(f),i.addEventListener("submit",(function(i){i.preventDefault();const r=new FormData(this);confirm("Are you sure you want to edit this task?")&&(t.editTask(e,r,n),t.saveTasks(),o(t.retrieveTasks()))})),i};return{render:function(n){o(n),function(){const n=document.createElement("label");n.innerText="Title: ",i.appendChild(n);const r=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("name","title"),r.setAttribute("required",""),i.appendChild(r);const s=document.createElement("label");s.innerText="Project: ",i.appendChild(s);const c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("name","project"),c.setAttribute("required",""),c.setAttribute("list","projects");const a=document.createElement("datalist");a.setAttribute("id","projects"),t.retrieveProjectList().forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),a.appendChild(t)})),c.appendChild(a),i.appendChild(c);const d=document.createElement("label");d.innerText="Done by: ",i.appendChild(d);const l=document.createElement("input");l.setAttribute("value",(new Date).toJSON().slice(0,10)),l.setAttribute("type","date"),l.setAttribute("name","date"),l.setAttribute("required",""),l.setAttribute("min",(new Date).toJSON().slice(0,10)),l.setAttribute("max",new Date((new Date).setFullYear((new Date).getFullYear()+1)).toJSON().slice(0,10)),i.appendChild(l);const u=document.createElement("label");u.innerText="Priority: ",i.appendChild(u);const p=document.createElement("select");p.setAttribute("name","priority"),p.setAttribute("required","");const m=document.createElement("option");m.setAttribute("value","1"),m.innerText="High",p.appendChild(m);const b=document.createElement("option");b.setAttribute("value","2"),b.innerText="Medium",p.appendChild(b);const h=document.createElement("option");h.setAttribute("value","3"),h.innerText="Low",p.appendChild(h),i.appendChild(p);const E=document.createElement("label");E.innerText="Description: ",i.appendChild(E);const A=document.createElement("textarea");A.classList.toggle("desc"),A.setAttribute("name","description"),A.setAttribute("type","text"),A.setAttribute("required",""),i.appendChild(A);const T=document.createElement("button");T.innerText="Create new task",T.setAttribute("type","submit"),i.appendChild(T),i.addEventListener("submit",(function(n){n.preventDefault();const i=new FormData(this),r=new e(i.get("title"),i.get("project"),i.get("date"),i.get("priority"),i.get("description"));t.saveTask(r),o(t.retrieveTasks())}))}(),function(){const e=document.createElement("label");e.innerText="Select what project to view",r.appendChild(e);const n=document.createElement("select");n.setAttribute("name","project"),n.setAttribute("id","project-select");const i=document.createElement("option");i.setAttribute("value","all"),i.innerText="All projects",n.appendChild(i),t.retrieveProjectList().forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),t.innerText=e,n.appendChild(t)})),n.addEventListener("change",(function(e){if("all"!=e.target.value){const n=t.retrieveProjectTasks(e.target.value);o(n)}else o(t.retrieveTasks())})),r.appendChild(n)}()}}}();!async function(){await t.loadDB();const e=await t.retrieveTasks();console.log(e),n.render(e)}()})();